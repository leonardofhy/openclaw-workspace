# 資深工程師思維模型 — 完整參考指南

> 原始來源：Leo 收集整理的 Senior Engineer Mode 體系（2026-02-24）
> 用途：SKILL.md 的詳細參考背景，不需要每次載入

## 一、資深工程師的思維模型

### 1) 以約束驅動決策，而不是以靈感驅動寫碼
- 目標是什麼（業務/用戶價值）？
- 約束是什麼（性能、成本、時程、安全、團隊能力、既有架構）？
- 失敗代價是什麼（數據錯、錢錯、隱私錯、停機）？
- "不做什麼"（non-goals）是什麼？
- **AI 常見問題**：沒有約束就開始堆疊抽象，產生冗余與複雜度。

### 2) "先讀後寫"：尊重既有代碼庫與一致性
- 找到現有模式/約定（命名、分層、錯誤處理、日誌、測試風格）
- 複用現有組件、減少新增概念
- 用最小 diff 達成目標
- **AI 常見問題**：從零發明新風格，導致代碼庫風格撕裂。

### 3) 最小變更 + 漸進交付
- 小步提交、容易 review
- 先做 MVP 再迭代
- 高風險改動做 feature flag / 灰度 / 回滾預案
- **AI 常見問題**：一口氣寫很大塊，無法驗證，難回滾。

### 4) 設計為了維護：可讀性 > 炫技
- 可讀、可定位、可觀測
- 明確邊界（模組/服務/層次/接口）
- 少魔法（減少隱式行為、反射、全局狀態）
- 不過度工程（YAGNI），但保留擴展點
- **AI 常見問題**：為了"看起來架構很強"引入不必要的層。

### 5) 把"正確性"制度化
- 自動化測試（單元/集成/端到端）
- 類型系統/linters/格式化
- 日誌、指標、追蹤、告警
- **AI 常見問題**：只給代碼不給驗證策略。

### 6) 用 trade-off 講話
- 寫下為什麼這樣做（ADR/設計說明）
- 明確 alternatives 與風險
- **AI 常見問題**：只給結論不給理由。

---

## 二、5 段式工程流程

### Phase 0：澄清與邊界（≤10% 篇幅）
- 目標、非目標
- 風險點
- 缺失信息：最多 3 個阻塞問題，否則寫假設繼續

### Phase 1：方案（含 trade-off）
- 推薦方案 1 個 + 備選最多 1 個
- 成本、複雜度、維護性、風險

### Phase 2：變更最小化的實現計劃
- 要改的模組/文件
- 新增/修改的接口
- 遷移/兼容策略

### Phase 3：驗證策略（必須落地）
- 單元測試：關鍵邏輯與邊界
- 集成測試：關鍵鏈路
- 回歸點：可能被影響的功能

### Phase 4：上線與運維（按需要）
- 日誌/指標/告警點
- 回滾方案

---

## 三、反 Vibe Coding 硬約束

1. **默認輸出"變更摘要 + 關鍵片段"**，不是整坨代碼
2. **強制"停下來想風險"**：哪裡最容易出 bug？如何檢測？如何回滾？
3. **限定方案數量與段落長度**：最多 2 方案，每段不超 6 行
4. **兼容既有約定**：沿用現有 pattern，不引入新框架

---

## 四、配套模板

### ADR 模板
```
ADR-XXX: <標題>
日期: YYYY-MM-DD
Context: 當前問題與背景、約束、關鍵質量屬性
Decision: 我們決定...
Alternatives: 方案 A/B 優缺點
Consequences: 正面影響、負面影響/風險、緩解措施
```

### PR Checklist
- [ ] 改動範圍最小化（無無關重構）
- [ ] 命名、分層、風格與現有代碼一致
- [ ] 輸入驗證與錯誤處理完整（含邊界條件）
- [ ] 關鍵路徑有測試
- [ ] 關鍵日誌到位（不洩露敏感信息）
- [ ] 性能影響評估
- [ ] 兼容性與遷移策略明確
- [ ] 回滾方案明確

### Definition of Done
- 功能：滿足成功標準，包含失敗場景行為
- 測試：覆蓋關鍵邏輯 + 邊界條件 + 回歸點
- 文檔：README/接口說明更新（按需）
- 安全：輸入驗證、最小權限、敏感數據處理
- 交付：小步提交，可回滾

---

## 五、5 個場景 Prompt

### Prompt 1：功能開發
```
任務：為系統新增功能：<一句話描述>
背景：<系統/模組/現狀>
約束：<性能/兼容/時程/不可動的部分>
成功標準：<可驗證的標準>
相關代碼/接口：<片段>
→ 輸出：TL;DR → 理解 → 方案(trade-off) → 計劃 → 變更摘要 → 測試 → 風險&回滾
```

### Prompt 2：修 Bug
```
現象：<錯誤行為>
複現步驟/日誌/堆棧：<貼出來>
影響範圍：<用戶/數據/頻率>
代碼位置：<文件路徑>
→ 輸出：根因假設(≤3) → 驗證方法 → 最小修復 → 回歸測試清單 → 監控&回滾
```

### Prompt 3：重構
```
目標：<降低耦合/去重複/提高可測性>
行為不可變：<保持不變的要求>
範圍：<只能改的模組>
→ 輸出：最小安全路徑(分步) → 每步可驗證 → 必要 vs 不做的抽象 → 止損條件
```

### Prompt 4：架構設計
```
需求：<業務目標>
規模：<QPS/數據量>
質量屬性：<SLA/延遲/成本>
→ 輸出：TL;DR → 決策(trade-off) → 模組邊界 → 數據模型 → 失敗降級 → ADR
```

### Prompt 5：上線前審查
```
變更內容：<做了什麼>
影響面：<服務/用戶/數據>
依賴：<DB/缓存/第三方>
→ 輸出：風險清單 → 監控告警 → 回滾策略 → Runbook → 驗證 checklist
```
